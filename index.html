<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜ì´ ì±„ìš©ê³µê³ </title>
  <style>
    :root {
      --bg: #ffffff;
      --card: #fff;
      --text: #0b1020;
      --muted: #606a7a;
      --accent: #1d4ed8;
      --border: #e5e7eb;
      --badge: #f1f5f9;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial,
        "Helvetica Neue", sans-serif;
    }
    .wrap { max-width: 1140px; margin: 28px auto; padding: 0 16px 40px; }
    header {
      display: flex; gap: 12px; align-items: center;
      justify-content: space-between; flex-wrap: wrap;
    }
    h1 { font-size: 20px; margin: 0; }
    
    /* ë°©ë¬¸ì ìˆ˜ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .visitor-stats {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 8px 12px;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 1px solid #bae6fd;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
    }
    .visitor-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .visitor-icon {
      font-size: 16px;
    }
    .visitor-label {
      color: var(--muted);
      font-size: 12px;
    }
    .visitor-count {
      color: var(--accent);
      font-weight: 800;
      font-size: 15px;
    }
    .visitor-divider {
      width: 1px;
      height: 20px;
      background: #bae6fd;
    }
    
    .tabs {
      display: flex; gap: 6px; flex-wrap: wrap; margin: 12px 0;
    }
    .tab {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 12%, transparent), transparent);
      padding: 8px 10px; border-radius: 10px; cursor: pointer;
      font-weight: 800; transition: all 0.2s;
    }
    .tab:hover {
      transform: translateY(-1px);
      background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 18%, transparent), transparent);
    }
    .tab[aria-selected="true"] {
      outline: 2px solid color-mix(in srgb, var(--accent) 50%, transparent);
      background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 20%, transparent), transparent);
    }
    .toolbar {
      display: flex; gap: 8px; flex-wrap: wrap; margin: 8px 0;
    }
    .input {
      background: #ffffff; border: 1px solid var(--border);
      border-radius: 10px; padding: 8px 10px;
      color: var(--text); transition: all 0.3s;
    }
    .input:focus {
      outline: none; border-color: #1d4ed8;
      box-shadow: 0 0 0 3px rgba(29,78,216,0.1);
    }
    select.input {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23606a7a' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 32px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(1,minmax(0,1fr));
      gap: 14px; margin-top: 12px;
    }
    @media (min-width:640px){ .grid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media (min-width:980px){ .grid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
    .card {
      background: #ffffff; border: 1px solid #e5e7eb;
      border-radius: 14px; padding: 14px;
      display: flex; flex-direction: column; gap: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: all 0.3s; position: relative; overflow: hidden;
    }
    .card::before {
      content: ''; position: absolute; top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(29,78,216,0.05), transparent);
      transition: left 0.6s;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      border-color: #1d4ed8;
    }
    .card:hover::before { left: 100%; }
    .title { font-weight: 800; font-size: 16px; margin: 0; word-break: keep-all; }
    .badges { display: flex; gap: 6px; flex-wrap: wrap; }
    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: var(--badge); border: 1px dashed var(--border);
      padding: 3px 8px; border-radius: 999px;
      font-size: 12px; font-weight: 700; transition: all 0.3s;
    }
    .badge[data-urgent="true"] {
      background: linear-gradient(135deg, rgba(220,38,38,0.3), rgba(153,27,27,0.4));
      border: 1px solid rgba(239,68,68,0.6);
      animation: pulse 2s ease-in-out infinite;
    }
    .badge[data-warning="true"] {
      background: linear-gradient(135deg, rgba(234,88,12,0.3), rgba(194,65,12,0.4));
      border: 1px solid rgba(249,115,22,0.6);
    }
    .badge[data-normal="true"] {
      background: linear-gradient(135deg, rgba(37,99,235,0.3), rgba(30,64,175,0.4));
      border: 1px solid rgba(59,130,246,0.6);
    }
    @keyframes pulse {
      0%,100%{transform:scale(1)} 50%{transform:scale(1.05)}
    }
    .row { display: flex; gap: 8px; font-size: 13px; color: var(--muted); }
    .k { width: 64px; flex: 0 0 64px; color: var(--text); font-weight: 700; }
    .v { flex: 1; min-width: 0; }
    .btn-link {
      display: inline-flex; justify-content: center; align-items: center;
      padding: 9px 10px; border-radius: 10px;
      border: 1px solid var(--border); text-decoration: none;
      color: var(--text); font-weight: 800; transition: all 0.3s;
    }
    .btn-link:hover {
      background: #1d4ed8; border-color: #1d4ed8; color: #fff;
      transform: translateY(-1px);
    }
    .empty {
      border: 1px dashed var(--border);
      border-radius: 12px; padding: 18px;
      text-align: center; color: var(--muted); margin-top: 14px;
    }
    footer { margin-top: 22px; font-size: 12px; color: var(--muted); text-align: center; }
    .count { font-size: 13px; color: var(--muted); }
    .filter-bar {
      display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0;
      padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb;
      border-radius: 12px;
    }
    .filter-btn {
      padding: 6px 12px; border-radius: 8px; border: 1px solid #e5e7eb;
      background: #ffffff; color: var(--text);
      font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.3s;
    }
    .filter-btn:hover { background:#f3f4f6; border-color:#1d4ed8; transform:translateY(-1px) }
    .filter-btn.active { background:#1d4ed8; border-color:#1d4ed8; color:#fff }
    .tab-cta { padding:6px 8px; font-size:14px; text-decoration:none; display:inline-flex; align-items:center; }
    .chip-btn {
      display:inline-flex; align-items:center; gap:6px;
      border:1px dashed var(--border); background:var(--badge);
      padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700;
      cursor:pointer; transition:all .2s;
    }
    .chip-btn:hover { transform:translateY(-1px); border-color:#1d4ed8 }
    .chip-btn:disabled { opacity:0.5; cursor:not-allowed }
    .notice-backdrop {
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.35); z-index:9999;
    }
    .notice {
      width:min(520px,92%); background:#fff; border:1px solid var(--border);
      border-radius:16px; box-shadow:0 12px 36px rgba(0,0,0,.25);
      overflow:hidden; transform:translateY(10px); opacity:0;
      transition:transform .2s ease, opacity .2s ease;
    }
    .notice.show { transform:translateY(0); opacity:1; }
    .notice__head {
      display:flex; align-items:center; gap:10px; padding:14px 16px;
      background:linear-gradient(135deg, color-mix(in srgb, var(--accent) 12%, transparent), transparent);
      border-bottom:1px solid var(--border);
    }
    .notice__icon {
      display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border-radius:10px;
      background:color-mix(in srgb, var(--accent) 12%, var(--badge));
      border:1px dashed var(--border); font-size:18px;
    }
    .notice__title { margin:0; font-size:16px; font-weight:900; }
    .notice__body { padding:16px; color:var(--text); }
    .notice__footer {
      display:flex; gap:8px; justify-content:flex-end;
      padding:12px 16px; border-top:1px solid var(--border);
    }
    .notice-btn {
      padding:8px 12px; border-radius:10px; border:1px solid var(--border);
      background:#fff; font-weight:800; cursor:pointer;
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .notice-btn:hover { transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.12); }
    .notice-btn.primary { background:var(--accent); border-color:var(--accent); color:#fff; }
    .sync-status {
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 8px; background:var(--badge);
      border:1px dashed var(--border); border-radius:8px; font-size:12px; font-weight:700;
    }
    .sync-status.active { color:#16a34a; border-color:#86efac }
    .sync-status.error { color:#dc2626; border-color:#fca5a5 }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ì˜ë£Œê¸°ê´€ ì±„ìš© ê³µê³  Â· 12ê°œ í˜ì´ì§€</h1>
      
      <!-- ë°©ë¬¸ì í†µê³„ -->
      <div class="visitor-stats">
        <div class="visitor-item">
          <span class="visitor-icon">ğŸ‘¤</span>
          <div>
            <div class="visitor-label">ì˜¤ëŠ˜</div>
            <div class="visitor-count" id="todayCount">0</div>
          </div>
        </div>
        <div class="visitor-divider"></div>
        <div class="visitor-item">
          <span class="visitor-icon">ğŸ‘¥</span>
          <div>
            <div class="visitor-label">ì „ì²´</div>
            <div class="visitor-count" id="totalCount">0</div>
          </div>
        </div>
      </div>
      
      <span class="sync-status" id="syncStatus">â—<span id="syncText">ë™ê¸°í™” ì¤‘...</span></span>
    </header>

    <div class="tabs" role="tablist"></div>

    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all">ì „ì²´</button>
      <button class="filter-btn" data-filter="urgent">ğŸ”¥ ê¸´ê¸‰ (D-1)</button>
      <button class="filter-btn" data-filter="soon">âš¡ ì„ë°• (D-2~5)</button>
      <button class="filter-btn" data-filter="normal">ğŸ“Œ ì¼ë°˜ (D-6+)</button>
      <button class="filter-btn" data-filter="unrelated">ğŸš« ê´€ë ¨ ì—†ìŒ</button>
    </div>

    <div class="toolbar">
      <input class="input" placeholder="ë³‘ì›ëª… ë˜ëŠ” ê³µê³  ê²€ìƒ‰" id="search" />
      <select class="input" id="sort">
        <option value="recent">ìµœì‹ ìˆœ</option>
        <option value="deadline">ë§ˆê°ì„ë°•ìˆœ</option>
      </select>
      <span class="count" id="count">0ê±´</span>
    </div>

    <section class="grid" id="list" role="list"></section>
    <div class="empty" style="display:none" id="empty">
      ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
    </div>

    <footer>
      â“’ 2025 ì˜ë£Œê¸°ê´€ ì±„ìš© ê³µê³  í†µí•© í”Œë«í¼. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ .
    </footer>
  </div>

  <!-- ê³µì§€ ëª¨ë‹¬ -->
  <div class="notice-backdrop" id="noticeBackdrop">
    <div class="notice">
      <div class="notice__head">
        <span class="notice__icon">ğŸ“¢</span>
        <h2 class="notice__title">ê³µì§€ì‚¬í•­</h2>
      </div>
      <div class="notice__body">
        <p style="margin:0 0 10px">ì˜ë£Œê¸°ê´€ ì±„ìš© ê³µê³  ì‚¬ì´íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</p>
        <p style="margin:0">ìµœì‹  ì±„ìš© ì •ë³´ë¥¼ í™•ì¸í•˜ê³ , ì›í•˜ëŠ” ë³‘ì›ì„ ì°¾ì•„ë³´ì„¸ìš”. ê²Œì‹œíŒì—ì„œ ë³‘ì› ì¶”ê°€ ìš”ì²­ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
      </div>
      <div class="notice__footer">
        <button class="notice-btn" id="noticeHideToday">ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸°</button>
        <button class="notice-btn primary" id="noticeClose">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ë°©ë¬¸ì ì¶”ì  ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    (function() {
      const VISITOR_KEY = 'site.visitor';
      const TODAY_KEY = 'site.visitor.today';
      
      function getTodayString() {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      }
      
      function initVisitorTracking() {
        const today = getTodayString();
        
        // ì „ì²´ ë°©ë¬¸ì ìˆ˜
        let totalVisitors = parseInt(localStorage.getItem(VISITOR_KEY) || '0', 10);
        
        // ì˜¤ëŠ˜ ë°©ë¬¸ ê¸°ë¡
        const todayData = JSON.parse(localStorage.getItem(TODAY_KEY) || '{}');
        
        // ë‚ ì§œê°€ ë°”ë€Œì—ˆìœ¼ë©´ ì˜¤ëŠ˜ ë°©ë¬¸ì ìˆ˜ ì´ˆê¸°í™”
        if (todayData.date !== today) {
          todayData.date = today;
          todayData.count = 0;
          todayData.visited = false;
        }
        
        // ì˜¤ëŠ˜ ì²« ë°©ë¬¸ì´ë©´ ì¹´ìš´íŠ¸ ì¦ê°€
        if (!todayData.visited) {
          totalVisitors++;
          todayData.count++;
          todayData.visited = true;
          
          localStorage.setItem(VISITOR_KEY, totalVisitors.toString());
          localStorage.setItem(TODAY_KEY, JSON.stringify(todayData));
        }
        
        // í™”ë©´ì— í‘œì‹œ
        document.getElementById('todayCount').textContent = todayData.count.toLocaleString();
        document.getElementById('totalCount').textContent = totalVisitors.toLocaleString();
      }
      
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°©ë¬¸ì ì¶”ì  ì´ˆê¸°í™”
      initVisitorTracking();
    })();
  </script>

  <!-- ê¸°ì¡´ ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    (async function() {
      const tabsEl = document.querySelector('.tabs');
      const qEl = document.getElementById('search');
      const sortEl = document.getElementById('sort');
      const listEl = document.getElementById('list');
      const emptyEl = document.getElementById('empty');
      const countEl = document.getElementById('count');
      const syncStatus = document.getElementById('syncStatus');
      const syncText = document.getElementById('syncText');

      const SOURCES = [
        { id:'amc', label:'ì„œìš¸ì•„ì‚°ë³‘ì›', path:'./normalized/amc.json' },
        { id:'caumc', label:'ì¤‘ì•™ëŒ€ë³‘ì›', path:'./normalized/caumc.json' },
        { id:'cmcseoul', label:'ê°€í†¨ë¦­ ì„œìš¸ì„±ëª¨', path:'./normalized/cmcseoul.json' },
        { id:'gunguk', label:'ê±´êµ­ëŒ€ë³‘ì›', path:'./normalized/gunguk.json' },
        { id:'hyumc', label:'í•œì–‘ëŒ€ë³‘ì›', path:'./normalized/hyumc.json' },
        { id:'kbsmc', label:'ê°•ë¶ì‚¼ì„±ë³‘ì›', path:'./normalized/kbsmc.json' },
        { id:'khmc', label:'ê²½í¬ì˜ë£Œì›', path:'./normalized/khmc.json' },
        { id:'kumc', label:'ê³ ë ¤ëŒ€ì˜ë£Œì›', path:'./normalized/kumc.json' },
        { id:'mokdong', label:'ì´ëŒ€ëª©ë™', path:'./normalized/mokdong.json' },
        { id:'samsung', label:'ì‚¼ì„±ì„œìš¸', path:'./normalized/samsung.json' },
        { id:'sebrance', label:'ì„¸ë¸Œë€ìŠ¤', path:'./normalized/sebrance.json' },
        { id:'seoul', label:'ì„œìš¸ëŒ€ë³‘ì›', path:'./normalized/seoul.json' },
        { id:'seoul_mokdong', label:'ì´ëŒ€ì„œìš¸', path:'./normalized/seoul_mokdong.json'},
        { id:'snubh', label:'ì„œìš¸ë¶„ë‹¹', path:'./normalized/snubh.json'},
    ];
      const ALL_ID = '__all__';
      const UNRELATED_KEY = 'site.unrelated';
      let unrelatedSet = new Set(JSON.parse(localStorage.getItem(UNRELATED_KEY)||'[]'));

      function keyOf(it){ return `${it.__source||''}||${it.title||''}||${it.start_dt||''}||${it.end_dt||''}`; }

      async function addUnrelated(k){
        unrelatedSet.add(k);
        localStorage.setItem(UNRELATED_KEY, JSON.stringify([...unrelatedSet]));
        apply();
      }
      async function removeUnrelated(k){
        unrelatedSet.delete(k);
        localStorage.setItem(UNRELATED_KEY, JSON.stringify([...unrelatedSet]));
        apply();
      }

      async function loadJson(path, label){
        syncText.textContent = `${label} ë¡œë”© ì¤‘...`;
        try {
          const r = await fetch(path);
          if(!r.ok) throw new Error(`${path} ë¡œë“œ ì‹¤íŒ¨`);
          const data = await r.json();
          return data.map(x=>({...x, __source:label}));
        } catch(e) {
          console.warn(`${path} ë¡œë“œ ì˜¤ë¥˜:`, e);
          return [];
        }
      }

      syncText.textContent = 'ë°ì´í„° ë¡œë”© ì¤‘...';
      const loaded = await Promise.all(SOURCES.map(s => loadJson(s.path, s.label)));
      const dataById = Object.fromEntries(SOURCES.map((s,i) => [s.id, loaded[i]]));
      const allData = SOURCES.flatMap((s,i) => loaded[i]);

      syncStatus.className = 'sync-status active';
      syncText.textContent = 'ë™ê¸°í™” ì™„ë£Œ';

      function buildTabs() {
        const nodes = [];
        const mk = (id, label, n) => {
          const b = document.createElement('button');
          b.className = 'tab'; b.role = 'tab'; b.dataset.id = id;
          b.textContent = `${label}${typeof n === 'number' ? ` (${n})` : ''}`;
          b.addEventListener('click', () => selectTab(id));
          return b;
        };
        nodes.push(mk(ALL_ID, 'ì „ì²´', allData.length));
        for (const s of SOURCES) nodes.push(mk(s.id, s.label, (dataById[s.id]||[]).length));

        const guestbookCta = document.createElement('a');
        guestbookCta.href = './guestbook.html';
        guestbookCta.className = 'tab tab-cta';
        guestbookCta.textContent = 'ğŸ’¬ ë³‘ì› ì¶”ê°€ ê²Œì‹œíŒ';
        guestbookCta.setAttribute('role', 'link');

        const adminCta = document.createElement('a');
        adminCta.href = './admin.html';
        adminCta.className = 'tab tab-cta';
        adminCta.textContent = 'ğŸ”§ ê´€ë¦¬ì';
        adminCta.setAttribute('role', 'link');

        nodes.push(guestbookCta, adminCta);
        tabsEl.replaceChildren(...nodes);
      }

      function makeCard(it) {
        const card = document.createElement('article');
        card.className = 'card';
        card.role = 'listitem';

        const h3 = document.createElement('h3');
        h3.className = 'title';
        h3.textContent = it.title || '(ì œëª© ì—†ìŒ)';

        const badges = document.createElement('div');
        badges.className = 'badges';

        if (it.dday) {
          const b = document.createElement('span');
          b.className = 'badge';
          b.textContent = it.dday;
          const m = it.dday.match(/D-(\d+)/);
          if (m) {
            const days = parseInt(m[1],10);
            if (days <= 1) b.dataset.urgent = true;
            else if (days <= 5) b.dataset.warning = true;
            else b.dataset.normal = true;
          }
          badges.appendChild(b);
        }

        if (it.__source) {
          const b = document.createElement('span');
          b.className = 'badge';
          b.textContent = it.__source;
          badges.appendChild(b);
        }

        const row = (k,v) => {
          const r = document.createElement('div'); r.className='row';
          const kEl = document.createElement('div'); kEl.className='k'; kEl.textContent=k;
          const vEl = document.createElement('div'); vEl.className='v'; vEl.textContent=v||'-';
          r.append(kEl,vEl); return r;
        };

        card.append(h3, badges, row('ì‹œì‘', it.start_dt || '-'), row('ì¢…ë£Œ', it.end_dt || '-'));

        if (it.detail_url) {
          const a = document.createElement('a');
          a.className = 'btn-link'; a.href = it.detail_url; a.target = '_blank'; a.rel = 'noopener noreferrer';
          a.textContent = 'ê³µê³  ë³´ê¸°'; card.appendChild(a);
        }

        const actions = document.createElement('div');
        actions.style.display = 'flex'; actions.style.gap = '8px';
        const k = keyOf(it);
        const btn = document.createElement('button');
        btn.type = 'button'; btn.className = 'chip-btn';
        const isMarked = unrelatedSet.has(k);
        btn.textContent = isMarked ? 'âœ… ë˜ëŒë¦¬ê¸°' : 'ğŸš« ê´€ë ¨ ì—†ìŒ';
        btn.addEventListener('click', async () => {
          btn.disabled = true;
          if (unrelatedSet.has(k)) await removeUnrelated(k);
          else await addUnrelated(k);
          btn.disabled = false;
        });
        actions.appendChild(btn);
        card.appendChild(actions);
        return card;
      }

      let current = ALL_ID;
      function selectTab(id) {
        current = id;
        for (const btn of tabsEl.querySelectorAll('.tab')) {
          btn.setAttribute('aria-selected', btn.dataset.id === id ? 'true' : 'false');
        }
        apply();
      }

      const sourceList = () => current === ALL_ID ? [...allData] : [...(dataById[current] || [])];

      function apply() {
        const q = qEl.value.trim().toLowerCase();
        const sort = sortEl.value;
        const activeFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
        let arr = sourceList();

        if (activeFilter === 'unrelated') {
          arr = allData.filter(x => unrelatedSet.has(keyOf(x)));
        } else {
          if (q) arr = arr.filter(x => String(x.title||'').toLowerCase().includes(q));
          if (activeFilter !== 'all') {
            arr = arr.filter(x => {
              const m = x.dday?.match(/D-(\d+)/);
              if (!m) return false;
              const days = parseInt(m[1],10);
              if (activeFilter === 'urgent') return days <= 1;
              if (activeFilter === 'soon') return days >= 2 && days <= 5;
              if (activeFilter === 'normal') return days >= 6;
              return true;
            });
          }
          arr = arr.filter(x => !unrelatedSet.has(keyOf(x)));
        }

        listEl.innerHTML = '';
        if (!arr.length) {
          emptyEl.style.display='block';
          if (countEl) countEl.textContent='0ê±´';
          return;
        }
        emptyEl.style.display='none';
        arr.forEach(it => listEl.appendChild(makeCard(it)));
        if (countEl) countEl.textContent = `${arr.length}ê±´`;
      }

      window.applyFilters = apply;
      buildTabs();
      selectTab(ALL_ID);

      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active'); apply();
        });
      });

      qEl.addEventListener('input', apply);
      sortEl.addEventListener('change', apply);
    })();
  </script>

  <!-- ê³µì§€ ëª¨ë‹¬ ë™ì‘ -->
  <script>
    (function() {
      const KEY = 'site.notice.dismissedAt';
      const backdrop = document.getElementById('noticeBackdrop');
      const hideTodayBtn = document.getElementById('noticeHideToday');
      const closeBtn = document.getElementById('noticeClose');

      const todayStr = () => {
        const d = new Date();
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      };

      const dismissed = localStorage.getItem(KEY);
      if (dismissed !== todayStr()) {
        backdrop.style.display = 'flex';
        requestAnimationFrame(()=> backdrop.querySelector('.notice')?.classList.add('show'));
      }

      const close = (rememberToday=false) => {
        if (rememberToday) localStorage.setItem(KEY, todayStr());
        const box = backdrop.querySelector('.notice');
        box.classList.remove('show');
        setTimeout(()=>{ backdrop.style.display='none'; }, 180);
      };

      hideTodayBtn?.addEventListener('click', ()=> close(true));
      closeBtn?.addEventListener('click', ()=> close(false));
      backdrop.addEventListener('click', e => { if (e.target === backdrop) close(false); });
      document.addEventListener('keydown', e => { if (e.key === 'Escape' && backdrop.style.display === 'flex') close(false); });
    })();
  </script>
</body>
</html>