<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>의료기관 채용 공고 · 12개 페이지</title>
<style>
  :root{--bg:#ffffff;--card:#fff;--text:#0b1020;--muted:#606a7a;--accent:#1d4ed8;--border:#e5e7eb;--badge:#f1f5f9}
  *{box-sizing:border-box}
  html,body{margin:0;background:#ffffff;color:var(--text);font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",Arial,"Helvetica Neue",sans-serif}
  .wrap{max-width:1140px;margin:28px auto;padding:0 16px 40px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{font-size:20px;margin:0}
  .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:12px 0}
  .tab{border:1px solid var(--border);background:linear-gradient(180deg,color-mix(in srgb,var(--accent) 12%,transparent),transparent);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:800;transition:all 0.2s}
  .tab:hover{transform:translateY(-1px);background:linear-gradient(180deg,color-mix(in srgb,var(--accent) 18%,transparent),transparent)}
  .tab[aria-selected="true"]{outline:2px solid color-mix(in srgb,var(--accent) 50%, transparent);background:linear-gradient(180deg,color-mix(in srgb,var(--accent) 20%,transparent),transparent)}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .input{background:#ffffff;border:1px solid var(--border);border-radius:10px;padding:8px 10px;color:var(--text);transition:all 0.3s}
  .input:focus{outline:none;border-color:#1d4ed8;box-shadow:0 0 0 3px rgba(29,78,216,0.1)}
  select.input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23606a7a' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:32px}
  .input::placeholder{color:var(--muted);opacity:0.6}
  .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:14px;margin-top:12px}
  @media (min-width:640px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media (min-width:980px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
  .card{background:#ffffff;border:1px solid #e5e7eb;border-radius:14px;padding:14px;display:flex;flex-direction:column;gap:10px;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:all 0.3s;position:relative;overflow:hidden}
  .card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(29,78,216,0.05),transparent);transition:left 0.6s}
  .card:hover{transform:translateY(-4px);box-shadow:0 4px 12px rgba(0,0,0,0.15);border-color:#1d4ed8}
  .card:hover::before{left:100%}
  .title{font-weight:800;font-size:16px;margin:0;word-break:keep-all}
  .badges{display:flex;gap:6px;flex-wrap:wrap}
  .badge{display:inline-flex;align-items:center;gap:6px;background:var(--badge);border:1px dashed var(--border);padding:3px 8px;border-radius:999px;font-size:12px;font-weight:700;transition:all 0.3s}
  .badge[data-urgent="true"]{background:linear-gradient(135deg,rgba(220,38,38,0.3) 0%,rgba(153,27,27,0.4) 100%);border:1px solid rgba(239,68,68,0.6);color:#1f2937;font-weight:800;animation:pulse 2s ease-in-out infinite;box-shadow:0 4px 8px rgba(220,38,38,0.3),0 2px 4px rgba(0,0,0,0.2),inset 0 -2px 4px rgba(0,0,0,0.1),inset 0 1px 2px rgba(255,255,255,0.3);transform:translateY(-1px)}
  .badge[data-warning="true"]{background:linear-gradient(135deg,rgba(234,88,12,0.3) 0%,rgba(194,65,12,0.4) 100%);border:1px solid rgba(249,115,22,0.6);color:#1f2937;font-weight:800;box-shadow:0 4px 8px rgba(234,88,12,0.3),0 2px 4px rgba(0,0,0,0.2),inset 0 -2px 4px rgba(0,0,0,0.1),inset 0 1px 2px rgba(255,255,255,0.3);transform:translateY(-1px)}
  .badge[data-normal="true"]{background:linear-gradient(135deg,rgba(37,99,235,0.3) 0%,rgba(30,64,175,0.4) 100%);border:1px solid rgba(59,130,246,0.6);color:#1f2937;box-shadow:0 4px 8px rgba(37,99,235,0.3),0 2px 4px rgba(0,0,0,0.2),inset 0 -2px 4px rgba(0,0,0,0.1),inset 0 1px 2px rgba(255,255,255,0.3);transform:translateY(-1px)}
  @keyframes pulse{0%,100%{transform:translateY(-1px) scale(1)}50%{transform:translateY(-1px) scale(1.05)}}
  .row{display:flex;gap:8px;font-size:13px;color:var(--muted)}
  .k{width:64px;flex:0 0 64px;color:var(--text);font-weight:700}
  .v{flex:1;min-width:0}
  .btn-link{display:inline-flex;justify-content:center;align-items:center;padding:9px 10px;border-radius:10px;border:1px solid var(--border);text-decoration:none;color:var(--text);font-weight:800;transition:all 0.3s}
  .btn-link:hover{background:#1d4ed8;border-color:#1d4ed8;color:#fff;transform:translateY(-1px);box-shadow:0 4px 12px rgba(29,78,216,0.3)}
  .empty{border:1px dashed var(--border);border-radius:12px;padding:18px;text-align:center;color:var(--muted);margin-top:14px}
  footer{margin-top:22px;font-size:12px;color:var(--muted);text-align:center}
  .count{font-size:13px;color:var(--muted)}
  .filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0;padding:12px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px}
  .filter-btn{padding:6px 12px;border-radius:8px;border:1px solid #e5e7eb;background:#ffffff;color:var(--text);font-size:13px;font-weight:700;cursor:pointer;transition:all 0.3s}
  .filter-btn:hover{background:#f3f4f6;border-color:#1d4ed8;transform:translateY(-1px)}
  .filter-btn.active{background:#1d4ed8;border-color:#1d4ed8;color:#fff;box-shadow:0 4px 12px rgba(29,78,216,0.3)}
  .tab-cta{
    padding:6px 8px;      /* 기본 탭보다 조금 작게 */
    font-size:14px;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>채용 공고 · 12개 페이지</h1>
  </header>

  <nav class="tabs" id="tabs" role="tablist" aria-label="기관 선택"></nav>

  <div class="toolbar">
    <input id="q" class="input" placeholder="검색(제목 포함)" />
    <select id="sort" class="input">
      <option value="end_asc">종료 빠른순</option>
      <option value="end_desc">종료 느린순</option>
      <option value="start_asc">시작 빠른순</option>
      <option value="start_desc">시작 느린순</option>
      <option value="title_asc">제목 A→Z</option>
    </select>
  </div>

  <div class="filter-bar">
    <button class="filter-btn active" data-filter="all">전체</button>
    <button class="filter-btn" data-filter="urgent">🔴 긴급 (D-0~1)</button>
    <button class="filter-btn" data-filter="soon">🟠 마감임박 (D-2~5)</button>
    <button class="filter-btn" data-filter="normal">🔵 여유 (D-6+)</button>
  </div>

  <div id="list" class="grid" role="list"></div>
  <div id="empty" class="empty">표시할 데이터가 없습니다.</div>
  <footer>외부 JSON 로드 · Asia/Seoul</footer>
</div>

<!-- ↓ 스크립트는 반드시 </body> 바로 위에 둔다 ↓ -->
<script>
(async () => {
  const tz = 'Asia/Seoul';
  const $  = s => document.querySelector(s);

  // ▼ 여기 path만 네 실제 폴더로 맞춰라 (상대경로/대소문자 주의)
  const SOURCES = [
    { id:'amc',     label:'서울아산병원',   path:'./normalized/amc.json' },
    { id:'caumc',   label:'중앙대병원',     path:'./normalized/caumc.json' },
    { id:'cmcseoul',label:'가톨릭 서울성모', path:'./normalized/cmcseoul.json' },
    { id:'gunguk',  label:'건국대병원',     path:'./normalized/gunguk.json' },
    { id:'hyumc',   label:'한양대병원',     path:'./normalized/hyumc.json' },
    { id:'kbsmc',   label:'강북삼성병원',   path:'./normalized/kbsmc.json' },
    { id:'khmc',    label:'경희의료원',     path:'./normalized/khmc.json' },
    { id:'kumc',    label:'고려대의료원',   path:'./normalized/kumc.json' },
    { id:'mokdong', label:'이대목동',       path:'./normalized/mokdong.json' },
    { id:'samsung', label:'삼성서울',       path:'./normalized/samsung.json' },
    { id:'sebran',  label:'세브란스',       path:'./normalized/sebran.json' },
    { id:'seoul',   label:'서울대병원',     path:'./normalized/seoul.json' },
  ];
  const ALL_ID = '__all__';

  const tabsEl = $('#tabs');
  const listEl = $('#list'), emptyEl = $('#empty'), countEl = $('#count');
  const qEl = $('#q'),      sortEl = $('#sort');

  // 에러박스 (상단에 누적 표시)
  const errBox = document.createElement('div');
  errBox.style.cssText = 'display:none;border:1px solid #b91c1c;background:#7f1d1d;color:#fff;padding:8px 10px;border-radius:8px;margin-top:8px;white-space:pre-wrap';
  document.querySelector('.wrap').insertBefore(errBox, document.querySelector('.toolbar'));
  const showError = (msg) => { errBox.textContent = msg; errBox.style.display = msg ? 'block' : 'none'; };

  // JSON 로더(진단 로그 강화)
  async function loadJson(path, label){
    try{
      const res  = await fetch(path + `?t=${Date.now()}`, { cache:'no-store' });
      const text = await res.text();
      if(!res.ok) throw new Error(`${res.status} ${res.statusText} · body: ${text.slice(0,200)}`);
      let data;
      try {
        data = JSON.parse(text);
      } catch {
        // 주석/트레일링 콤마 정리 후 재파싱
        const cleaned = text.replace(/\/\/.*$/mg,'').replace(/\/\*[\s\S]*?\*\//g,'').replace(/,\s*([}\]])/g,'$1');
        data = JSON.parse(cleaned);
      }
      if(!Array.isArray(data)) data = [data];
      return data.map(x => ({ ...x, __source: label }));
    }catch(e){
      showError((errBox.textContent ? errBox.textContent + '\n' : '') + `불러오기 실패: ${label} (${path}) → ${e.message}`);
      return [];
    }
  }

  // 모든 소스 병렬 로딩
  const loaded   = await Promise.all(SOURCES.map(s => loadJson(s.path, s.label)));
  const dataById = Object.fromEntries(SOURCES.map((s,i) => [s.id, loaded[i]]));
  const allData  = SOURCES.flatMap((s,i) => loaded[i]);

  // 탭 구성
  function buildTabs(){
    const nodes = [];
    const mk = (id, label, n) => {
      const b = document.createElement('button');
      b.className = 'tab'; b.role = 'tab'; b.dataset.id = id;
      b.textContent = `${label}${typeof n==='number' ? ` (${n})` : ''}`;
      b.addEventListener('click', () => selectTab(id));
      return b;
    };
    nodes.push(mk(ALL_ID, '전체', allData.length));
    for (const s of SOURCES) nodes.push(mk(s.id, s.label, (dataById[s.id]||[]).length));

    const cta = document.createElement('a');
    cta.href = './guestbook.html';
    cta.className = 'tab tab-cta';   // 탭 스타일 + 오른쪽 정렬
    cta.textContent = '병원 추가 게시판';
    cta.setAttribute('role','link');

    nodes.push(cta);
    tabsEl.replaceChildren(...nodes);
  }

  // 날짜 포맷
  const fmt = (dt) => {
    if (!dt) return '';
    const d = new Date(dt);
    if (isNaN(d)) return '';
    return new Intl.DateTimeFormat('ko-KR', {
      year:'numeric', month:'2-digit', day:'2-digit',
      hour:'2-digit', minute:'2-digit', hour12:false, timeZone: tz
    }).format(d).trim();
  };

  // 카드 생성
  function makeCard(it){
    const card = document.createElement('article'); card.className='card'; card.role='listitem';
    const h3   = document.createElement('h3'); h3.className='title'; h3.textContent = it.title || '(제목 없음)';
    const badges = document.createElement('div'); badges.className='badges';

    if (it.dday){
      const b = document.createElement('span'); b.className='badge'; b.textContent = it.dday;
      const m = it.dday.match(/D-(\d+)/);
      if (m){
        const days = parseInt(m[1],10);
        if (days <= 1) b.setAttribute('data-urgent','true');
        else if (days <= 5) b.setAttribute('data-warning','true');
        else b.setAttribute('data-normal','true');
      }
      badges.appendChild(b);
    }
    if (it.__source){
      const b = document.createElement('span'); b.className='badge'; b.textContent = it.__source;
      badges.appendChild(b);
    }

    const row = (k,v) => {
      const r = document.createElement('div'); r.className='row';
      const kEl = document.createElement('div'); kEl.className='k'; kEl.textContent = k;
      const vEl = document.createElement('div'); vEl.className='v'; vEl.textContent = v || '-';
      r.append(kEl,vEl); return r;
    };

    card.append(h3, badges, row('시작', fmt(it.start_dt)), row('종료', fmt(it.end_dt)));
    if (it.detail_url){
      const a = document.createElement('a'); a.className='btn-link'; a.href = it.detail_url; a.target='_blank'; a.rel='noopener noreferrer'; a.textContent='공고 보기';
      card.appendChild(a);
    }
    return card;
  }

  // 상태 & 렌더링
  let current = ALL_ID;
  function selectTab(id){
    current = id;
    for (const btn of tabsEl.querySelectorAll('.tab')){
      btn.setAttribute('aria-selected', btn.dataset.id===id ? 'true' : 'false');
    }
    apply();
  }
  const sourceList = () => current === ALL_ID ? [...allData] : [...(dataById[current] || [])];

  function apply(){
    const q = qEl.value.trim().toLowerCase();
    const sort = sortEl.value;
    const activeFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
    let arr = sourceList();

    if (q) arr = arr.filter(x => String(x.title||'').toLowerCase().includes(q));

    if (activeFilter !== 'all'){
      arr = arr.filter(x => {
        const m = x.dday?.match(/D-(\d+)/);
        if (!m) return false;
        const days = parseInt(m[1],10);
        if (activeFilter === 'urgent') return days <= 1;
        if (activeFilter === 'soon')   return days >= 2 && days <= 5;
        if (activeFilter === 'normal') return days >= 6;
        return true;
      });
    }

    const getEnd   = it => new Date(it.end_dt   || 8640000000000000).getTime();
    const getStart = it => new Date(it.start_dt || 8640000000000000).getTime();
    switch (sort){
      case 'end_asc':   arr.sort((a,b)=> getEnd(a)-getEnd(b));   break;
      case 'end_desc':  arr.sort((a,b)=> getEnd(b)-getEnd(a));   break;
      case 'start_asc': arr.sort((a,b)=> getStart(a)-getStart(b)); break;
      case 'start_desc':arr.sort((a,b)=> getStart(b)-getStart(a)); break;
      case 'title_asc': arr.sort((a,b)=> String(a.title||'').localeCompare(String(b.title||''),'ko')); break;
    }

    listEl.innerHTML = '';
    if (!arr.length){
      emptyEl.style.display='block'; countEl.textContent='0건'; return;
    }
    emptyEl.style.display='none';
    arr.forEach(it => listEl.appendChild(makeCard(it)));
    countEl.textContent = `${arr.length}건`;
  }

  buildTabs();
  selectTab(ALL_ID);

  // UI 이벤트
  document.querySelectorAll('.filter-btn').forEach(btn=>{
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      apply();
    });
  });
  qEl.addEventListener('input', apply);
  sortEl.addEventListener('change', apply);
})();
</script>
</body>
</html>
