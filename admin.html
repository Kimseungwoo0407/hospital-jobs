<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>관리자 · 데이터 업데이트</title>
<style>
  :root{--bg:#ffffff;--card:#fff;--text:#0b1020;--muted:#606a7a;--accent:#1d4ed8;--border:#e5e7eb;--badge:#f1f5f9}
  *{box-sizing:border-box}
  html,body{margin:0;background:#f9fafb;color:var(--text);font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",sans-serif}
  .wrap{max-width:680px;margin:40px auto;padding:0 16px}
  header{text-align:center;margin-bottom:32px}
  h1{font-size:24px;margin:0 0 8px;font-weight:900}
  .subtitle{color:var(--muted);font-size:14px}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);margin-bottom:16px}
  .status-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:700;font-size:14px}
  .status-badge.idle{background:#f1f5f9;color:#475569}
  .status-badge.success{background:#dcfce7;color:#166534}
  .status-badge.error{background:#fee2e2;color:#991b1b}
  .btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:14px;border-radius:12px;border:none;font-weight:800;font-size:15px;cursor:pointer;transition:all 0.2s}
  .btn:disabled{opacity:0.5;cursor:not-allowed}
  .btn-primary{background:#1d4ed8;color:#fff}
  .btn-primary:hover:not(:disabled){background:#1e40af;transform:translateY(-2px);box-shadow:0 4px 12px rgba(29,78,216,0.3)}
  .btn-secondary{background:#f1f5f9;color:#475569;border:1px solid var(--border)}
  .btn-secondary:hover:not(:disabled){background:#e2e8f0}
  .alert{padding:12px 16px;border-radius:10px;margin:16px 0;font-size:13px;font-weight:600}
  .alert-info{background:#dbeafe;color:#1e40af;border:1px solid #93c5fd}
  .alert-error{background:#fee2e2;color:#991b1b;border:1px solid #fca5a5}
  footer{text-align:center;margin-top:32px;font-size:12px;color:var(--muted)}
  .link{color:var(--accent);text-decoration:none;font-weight:700}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>🔧 관리자 패널</h1>
    <p class="subtitle">GitHub Actions 기반 데이터 업데이트</p>
  </header>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <h3 style="margin:0;font-size:16px">현재 상태</h3>
      <span id="statusBadge" class="status-badge idle">⏸️ 대기 중</span>
    </div>

    <button id="updateBtn" class="btn btn-primary">
      <span>🔄</span>
      <span>공고 데이터 업데이트</span>
    </button>

    <div id="infoBox" class="alert alert-info">
      ⏰ 이 버튼을 누르면 GitHub Actions 워크플로우(<code>crawl.yml</code>)가 실행됩니다.<br>
      약 5~10분 후 데이터가 자동 갱신됩니다.
    </div>

    <div id="errorBox" class="alert alert-error" style="display:none"></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 12px;font-size:16px">빠른 이동</h3>
    <div style="display:grid;gap:8px">
      <a href="./index.html" class="btn btn-secondary">📋 채용 공고 보기</a>
      <a href="./guestbook.html" class="btn btn-secondary">💬 건의사항 게시판</a>
      <a href="https://github.com/Kimseungwoo0407/hospital-jobs/actions" target="_blank" class="btn btn-secondary">⚙️ GitHub Actions 실행 로그 보기</a>
    </div>
  </div>

  <footer>
    GitHub Pages · Python Crawler · Automated Workflow
  </footer>
</div>

<script>
const OWNER = "Kimseungwoo0407";
const REPO = "hospital-jobs";
const WORKFLOW_FILE = "crawl.yml";

const statusBadge = document.getElementById('statusBadge');
const updateBtn = document.getElementById('updateBtn');
const errorBox = document.getElementById('errorBox');

async function triggerCrawl() {
  const token = prompt("GitHub Personal Access Token을 입력하세요:");

  if (!token) return alert("❌ 토큰이 필요합니다.");

  updateBtn.disabled = true;
  statusBadge.textContent = "🚀 실행 중...";
  statusBadge.className = "status-badge idle";

  try {
    const res = await fetch(
      `https://api.github.com/repos/${OWNER}/${REPO}/actions/workflows/${WORKFLOW_FILE}/dispatches`,
      {
        method: "POST",
        headers: {
          "Authorization": `token ${token}`,
          "Accept": "application/vnd.github.v3+json",
        },
        body: JSON.stringify({ ref: "main" }),
      }
    );

    if (res.ok) {
      statusBadge.textContent = "✅ 실행 요청 완료!";
      statusBadge.className = "status-badge success";
      alert("GitHub Actions 워크플로우가 실행되었습니다.\n잠시 후 데이터가 업데이트됩니다.");
    } else {
      const text = await res.text();
      statusBadge.textContent = "❌ 오류";
      statusBadge.className = "status-badge error";
      errorBox.style.display = "block";
      errorBox.textContent = text;
    }
  } catch (err) {
    statusBadge.textContent = "❌ 네트워크 오류";
    statusBadge.className = "status-badge error";
    errorBox.style.display = "block";
    errorBox.textContent = err.message;
  } finally {
    updateBtn.disabled = false;
  }
}

updateBtn.addEventListener('click', triggerCrawl);
</script>
</body>
</html>
