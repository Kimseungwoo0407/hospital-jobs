name: Crawl Jobs

on:
  workflow_dispatch:   # ìˆ˜ë™ / API íŠ¸ë¦¬ê±° ê°€ëŠ¥
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ ìì • (UTC ê¸°ì¤€)

jobs:
  crawl:
    runs-on: ubuntu-latest
    permissions:
      contents: write    # GitHub Actionsê°€ commit/push í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œ ë¶€ì—¬

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # ë³´ì•ˆìƒ ê¶Œì¥

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸš€ Run crawler
        run: |
          python src/run_all.py
          python normalize_jobs.py ./json

      - name: ğŸ’¾ Commit and push results
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "GitHub Actions"
          git config user.email "github-actions@github.com"

          git add normalized/ json/
          git commit -m "ğŸ”„ Update jobs $(date +'%Y-%m-%d %H:%M')" || echo "No changes to commit"
          git push

      - name: ğŸ”¥ Update Firebase status (optional)
        if: env.FIREBASE_TOKEN != ''
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        run: |
          echo "âœ… Crawl completed"
